(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{221:function(e,a,t){e.exports=t(403)},403:function(e,a,t){"use strict";t.r(a);var n=t(0),o=t.n(n),r=t(55),i=t.n(r),l=t(185),c=t(186),s=t(208),u=t(187),d=t(26),m=t(209),g=t(27),h=(t(273),t(274),t(188)),p=t(44),f=t.n(p),v=t(97),E=t.n(v),k=t(131),b=t.n(k),w=t(189),S=t.n(w),_=t(411),y=t(412),C=t(418),I=t(419),D=t(58),F=t(420),R=t(96),L=t(415),O=t(414),x=t(413),B=t(417),A=t(416);b.a.vfs=S.a.pdfMake.vfs;var j=function(e){function a(e){var t;return Object(l.a)(this,a),(t=Object(s.a)(this,Object(u.a)(a).call(this,e))).addToList=function(e){e.preventDefault();var a=t.state.currentValue;(a=a.split("\n")).forEach(function(e){t.getMetrics(e)})},t.getMetricsRefresh=function(e){var a,n;t.setState({loading:!0});var o,r=e.type,i=e.postId;t.state.facebookData.forEach(function(t){e.pageId===t.value&&(a=t)}),o="video"===r?"/".concat(a.value,"_").concat(i,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_video_views),name,message,created_time"):"/".concat(a.value,"_").concat(i,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_clicks),name,message,created_time"),window.FB.api(o,{access_token:a.access_token},function(o){n="video"===r?{link:e.link,postId:i,pageId:a.value,pageName:a.text,type:r,name:o.name,message:o.message,created_time:new Date(o.created_time).toLocaleString("en-SG"),impressions:o.insights.data[2].values[0].value,reach:o.insights.data[3].values[0].value,engagement:o.insights.data[1].values[0].value}:{link:e.link,postId:i,pageId:a.value,pageName:a.text,type:r,name:o.name,message:o.message,created_time:new Date(o.created_time).toLocaleString("en-SG"),impressions:o.insights.data[0].values[0].value,reach:o.insights.data[1].values[0].value,engagement:o.insights.data[2].values[0].value};var l=t.state.data;l.push(n),t.setState({data:l}),t.saveToDB(),t.setState({loading:!1})})},t.getMetrics=function(e){var a,n,o,r,i;t.state.facebookData.forEach(function(e){t.state.currentPage===e.value&&(a=e)}),e.includes("videos")?(o="video",r=e.slice(0,-1).split("/").pop(),i="/".concat(a.value,"_").concat(r,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_video_views),name,message,created_time")):(o="posts",r=e.split("/").pop(),i="/".concat(a.value,"_").concat(r,"/?fields=insights.metric(post_impressions,post_impressions_unique,post_clicks),name,message,created_time")),window.FB.api(i,{access_token:a.access_token},function(i){n="video"===o?{link:e,postId:r,pageId:a.value,pageName:a.text,type:o,name:i.name,message:i.message,created_time:new Date(i.created_time).toLocaleString("en-SG"),impressions:i.insights.data[2].values[0].value,reach:i.insights.data[3].values[0].value,engagement:i.insights.data[1].values[0].value}:{link:e,postId:r,pageId:a.value,pageName:a.text,type:o,name:i.name,message:i.message,created_time:new Date(i.created_time).toLocaleString("en-SG"),impressions:i.insights.data[0].values[0].value,reach:i.insights.data[1].values[0].value,engagement:i.insights.data[2].values[0].value};var l=t.state.data;l.push(n),t.setState({data:l,currentValue:""}),t.saveToDB()})},t.deleteRow=function(e){var a=t.state.data,n=f.a.remove(a,function(a){if(a.postId===e)return!0});t.setState({data:a}),t.saveToDB();var o=g.firestore();o.collection("records").doc(t.state.appUserID).get().then(function(e){if(e.exists)if(void 0!==e.data().archive){var a=e.data().archive;a.push(n[0]),o.collection("records").doc(t.state.appUserID).set({archive:a},{merge:!0})}else o.collection("records").doc(t.state.appUserID).set({archive:n},{merge:!0});else console.log("No such document!")}).catch(function(e){console.log("Error getting document",e)})},t.handleInputChange=function(e){t.setState({currentValue:e.target.value.split("?")[0]})},t.handleDropdownChange=function(e,a){var n=a.value;t.setState({currentPage:n})},t.handleSort=function(e){return function(){var a=t.state,n=a.column,o=a.data,r=a.direction;n===e?t.setState({data:o.reverse(),direction:"ascending"===r?"descending":"ascending"}):t.setState({column:e,data:f.a.sortBy(o,[e]),direction:"ascending"})}},t.state={accessToken:"",currentValue:"",currentPage:"",data:[],oldData:[],facebookData:[],items:[],loading:!1,appUserID:"",column:null,direction:null},t.loadFacebook=t.loadFacebook.bind(Object(d.a)(t)),t.addToList=t.addToList.bind(Object(d.a)(t)),t.forceRefresh=t.forceRefresh.bind(Object(d.a)(t)),t.buildReport=t.buildReport.bind(Object(d.a)(t)),t.firebaseUI=t.firebaseUI.bind(Object(d.a)(t)),t.deleteRow=t.deleteRow.bind(Object(d.a)(t)),t.signOut=t.signOut.bind(Object(d.a)(t)),t}return Object(m.a)(a,e),Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.loadFacebook();g.initializeApp({apiKey:"AIzaSyA_767ieKDCRaS8OgWK-Kr9aDAtzk2HLIo",authDomain:"editorial-tracker-cd9cd.firebaseapp.com",projectId:"editorial-tracker-cd9cd"}),g.auth().onAuthStateChanged(function(a){a?(e.loginFacebook(),e.setState({appUserID:a.uid}),console.log(a.uid),e.setState({loading:!0})):e.firebaseUI()})}},{key:"firebaseUI",value:function(){var e=this,a=new h.auth.AuthUI(g.auth()),t={callbacks:{signInSuccessWithAuthResult:function(a,t){return e.setState({accessToken:a.credential.accessToken}),e.loginFacebook(),!1}},signInFlow:"popup",signInOptions:[{provider:g.auth.FacebookAuthProvider.PROVIDER_ID,scopes:["manage_pages","read_insights"],customParameters:{auth_type:"reauthenticate"}}]};a.start("#firebaseui-auth-container",t)}},{key:"signOut",value:function(){g.auth().signOut(),this.setState({data:[]})}},{key:"loadFacebook",value:function(){!function(e,a,t){var n,o=e.getElementsByTagName(a)[0];e.getElementById(t)||((n=e.createElement(a)).id=t,n.src="https://connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(n,o))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){window.FB.init({appId:"1497929310342175",autoLogAppEvents:!0,xfbml:!0,version:"v3.2",state:!0})}}},{key:"loginFacebook",value:function(){var e=this;window.FB.getLoginStatus(function(a){"connected"===a.status?window.FB.api("/me/accounts?fields=id,name,access_token",function(a){e.setState({facebookData:a.data}),e.getFromDB(),e.populateSelect()}):console.log("Login Failed!")})}},{key:"getFromDB",value:function(){var e=this;g.firestore().collection("records").doc(this.state.appUserID).get().then(function(a){if(a.exists){var t=f.a.orderBy(a.data().data,"reach","asc");e.setState({loading:!1,data:t,column:"reach",direction:"ascending"})}else console.log("No such document!"),e.setState({loading:!1})}).catch(function(e){console.log("Error getting document",e)})}},{key:"saveToDB",value:function(){g.firestore().collection("records").doc(this.state.appUserID).set({data:this.state.data},{merge:!0})}},{key:"loader",value:function(){return this.state.loading?o.a.createElement(_.a,{active:!0}):o.a.createElement(_.a,{disabled:!0})}},{key:"forceRefresh",value:function(){var e=this;this.setState({oldData:this.state.data,data:[]}),this.state.data.forEach(function(a){e.getMetricsRefresh(a)})}},{key:"buildReport",value:function(){var e=[],a=f.a.orderBy(this.state.data,"reach","asc");e.push(["Page","Name","Impressions","Reach","Engagement","Age","Link"]),f.a.forEach(a,function(a){var t={text:a.reach.toLocaleString()};a.reach<25e3?t.fillColor="#F08080":a.reach<5e4?t.fillColor="#FF8C00":a.reach<1e5?t.fillColor="#FFFF00":a.reach<5e5&&(t.fillColor="#00FF7F"),e.push([a.pageName,a.name,a.impressions.toLocaleString(),t,a.engagement.toLocaleString(),E()(a.created_time,"DD/MM/YYYY h:mm a").fromNow(),{text:"Link",link:a.link,color:"blue"}])});var t={pageOrientation:"landscape",pageSize:"A4",content:[{text:"Facebook Reach Tracker",margin:[0,0,0,16],fontSize:24},{layout:"lightHorizontalLines",table:{widths:["auto","*","auto","auto","auto","auto","auto"],body:e}},{text:"Generated on "+E()().format("MMMM Do YYYY, h:mm:ss a"),margin:[0,16,0,0],fontSize:8}]};b.a.createPdf(t).open()}},{key:"populateSelect",value:function(){var e=[];this.state.facebookData.forEach(function(a){e.push({value:a.id,text:a.name,access_token:a.access_token})}),e.sort(function(e,a){return e.text.localeCompare(a.text)}),this.setState({facebookData:e})}},{key:"render",value:function(){var e=this,a=this.state,t=a.column,n=a.direction;return o.a.createElement("div",{className:"App"},o.a.createElement(y.a,{fluid:!0},o.a.createElement(C.a,{centered:!0,padded:!0,columns:3},o.a.createElement(C.a.Row,{centered:!0},o.a.createElement(C.a.Column,{width:3}),o.a.createElement(C.a.Column,{width:10},o.a.createElement(I.a,{as:"h1",icon:!0,textAlign:"center"},o.a.createElement(D.a,{name:"facebook"}),o.a.createElement(I.a.Content,null,"Facebook Insights Tracker")),o.a.createElement("div",{id:"firebaseui-auth-container"})),o.a.createElement(C.a.Column,{width:3},o.a.createElement(F.a,null,o.a.createElement(I.a,null,"Legend"),o.a.createElement(o.a.Fragment,null,o.a.createElement(R.a,{circular:!0,color:"red",empty:!0})," < 25,000",o.a.createElement("br",null),o.a.createElement(R.a,{circular:!0,color:"orange",empty:!0})," < 50,000",o.a.createElement("br",null),o.a.createElement(R.a,{circular:!0,color:"yellow",empty:!0})," < 100,000",o.a.createElement("br",null),o.a.createElement(R.a,{circular:!0,color:"green",empty:!0})," < 500,000",o.a.createElement("br",null),o.a.createElement(R.a,{circular:!0,color:"blue",empty:!0})," > 500,000")))),o.a.createElement(C.a.Row,null,o.a.createElement(y.a,null,o.a.createElement(L.a,{onSubmit:this.addToList},o.a.createElement(L.a.Group,null,o.a.createElement(O.a,{defaultValue:this.state.currentValue,onChange:this.handleInputChange,fluid:!0,required:!0,placeholder:"Link",type:"text",value:this.state.currentValue,width:8}),o.a.createElement(x.a,{placeholder:"Page",options:this.state.facebookData,onChange:this.handleDropdownChange,width:3}),o.a.createElement(B.a,{type:"submit",width:3},o.a.createElement(D.a,{fitted:!0,name:"add"})))))),o.a.createElement(C.a.Row,null,o.a.createElement(C.a.Column,{width:10},o.a.createElement(B.a,{color:"green",content:"Force Refresh",onClick:this.forceRefresh}),o.a.createElement(B.a,{color:"blue",content:"Export Report",onClick:this.buildReport}),o.a.createElement(B.a,{content:"Sign Out",onClick:this.signOut}))),o.a.createElement(C.a.Row,null,o.a.createElement(C.a.Column,{width:10},this.loader(),o.a.createElement(A.a,{striped:!0,compact:!0,sortable:!0,fixed:!0,singleLine:!0},o.a.createElement(A.a.Header,null,o.a.createElement(A.a.Row,null,o.a.createElement(A.a.HeaderCell,null,"Page"),o.a.createElement(A.a.HeaderCell,null,"Name"),o.a.createElement(A.a.HeaderCell,{sorted:"impressions"===t?n:null,onClick:this.handleSort("impressions")},"Impressions"),o.a.createElement(A.a.HeaderCell,{sorted:"reach"===t?n:null,onClick:this.handleSort("reach")},"Reach"),o.a.createElement(A.a.HeaderCell,{sorted:"engagement"===t?n:null,onClick:this.handleSort("engagement")},"Engagement"),o.a.createElement(A.a.HeaderCell,null,"Age"),o.a.createElement(A.a.HeaderCell,null,"Action"))),o.a.createElement(A.a.Body,null,f.a.map(this.state.data,function(a){var t=a.pageName,n=a.postId,r=a.name,i=a.impressions,l=a.reach,c=a.engagement,s=a.link,u=a.type,d=a.created_time;return o.a.createElement(A.a.Row,{key:n},o.a.createElement(A.a.Cell,null,t),o.a.createElement(A.a.Cell,null,r),o.a.createElement(A.a.Cell,null,i.toLocaleString()),o.a.createElement(A.a.Cell,null,l<25e3?o.a.createElement(R.a,{color:"red",size:"large"},o.a.createElement(D.a,{name:"warning sign"}),l.toLocaleString()):l<5e4?o.a.createElement(R.a,{color:"orange",size:"large"},o.a.createElement(D.a,{name:"attention"}),l.toLocaleString()):l<1e5?o.a.createElement(R.a,{color:"yellow",size:"large"},o.a.createElement(D.a,{name:"star half full"}),l.toLocaleString()):l<5e5?o.a.createElement(R.a,{color:"green",size:"large"},o.a.createElement(D.a,{name:"star"}),l.toLocaleString()):o.a.createElement(R.a,{color:"blue",size:"large"},o.a.createElement(D.a,{name:"diamond"}),l.toLocaleString())),o.a.createElement(A.a.Cell,null,o.a.createElement("p",null,"video"===u?"Video Views ":"Post Clicks "),c.toLocaleString()),o.a.createElement(A.a.Cell,null,E()(d,"DD/MM/YYYY h:mm a").fromNow()),o.a.createElement(A.a.Cell,{textAlign:"center"},o.a.createElement("a",{href:s,target:"_blank",rel:"noopener noreferrer"},o.a.createElement(B.a,{basic:!0,color:"blue",icon:"eye"})),o.a.createElement(B.a,{basic:!0,color:"red",icon:"trash alternate outline",onClick:function(){return e.deleteRow(n)}})))}))))))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(401),t(402);i.a.render(o.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[221,1,2]]]);
//# sourceMappingURL=main.3fb95105.chunk.js.map